/*------------------------------------------------------------------------------------------------------------------------
 * 文件名称：WDT.c

 * 文件内容：看门狗配置

 * 文件版本：1.0.0

 * 文件作者：麦特实验室

 * 开发环境：STC8A8K64S4A12@22.1184MHz芯片 & Keil uVision 5 

 * 注    意：
------------------------------------------------------------------------------------------------------------------------*/
/*------------------------------------------------------------------------------------------------------------------------
                                                  加载头文件区
------------------------------------------------------------------------------------------------------------------------*/
#include "STC8F.h"
#include "WDT.h"
/*------------------------------------------------------------------------------------------------------------------------
 * 函数名称：WDT_Init

 * 函数功能：看门狗初始化

 * 输入参数：无

 * 输出参数：无

 * 注    意：无
------------------------------------------------------------------------------------------------------------------------*/
void WDT_Init()
{
 	/*WDT_CONTR - 看门狗控制寄存器*/
	//bit7
//	WDT_CONTR &= 0x7F;//看门狗发生溢出时，硬件自动将此位置 1，需要软件清零
//	WDT_CONTR |= 0x80;//看门狗发生溢出时，硬件自动将此位置 1，需要软件清零
	//bit5
//	WDT_CONTR &= 0xDF;//对单片机无影响
	WDT_CONTR |= 0x20;//启动看门狗定时器
	//bit4
//	WDT_CONTR &= 0xEF;//对单片机无影响
	WDT_CONTR |= 0x10;//清零看门狗定时器，硬件自动将此位复位
	//bit3
//	WDT_CONTR &= 0xF7;//IDLE 模式时看门狗停止计数
	WDT_CONTR |= 0x08;//IDLE 模式时看门狗继续计数
	//bit2 - bit0 看门狗定时器时钟分频系数
	/*
	 WDT_PS[2:0] |分频系数 |12M 主频时的溢出时间 |20M 主频时的溢出时间
		000         2 			≈ 65.5 毫秒 		≈ 39.3 毫秒
		001 		4 			≈ 131 毫秒 			≈ 78.6 毫秒
		010 		8 			≈ 262 毫秒 			≈ 157 毫秒
		011 		16 			≈ 524 毫秒 			≈ 315 毫秒
		100 		32 			≈ 1.05 秒 			≈ 629 毫秒
		101 		64 			≈ 2.10 秒	 		≈ 1.26 秒
		110 		128 		≈ 4.20 秒	 		≈ 2.52 秒
		111 		256 		≈ 8.39 秒 			≈ 5.03秒
	*/
	WDT_CONTR |= 0x06;//设置2.27s
}
/*------------------------------------------------------------------------------------------------------------------------
 * 函数名称：RSTWDT

 * 函数功能：清空看门狗

 * 输入参数：无

 * 输出参数：无

 * 注    意：无
------------------------------------------------------------------------------------------------------------------------*/
void RSTWDT()
{
	WDT_CONTR |= 0x10;
}
/*------------------------------------------------------------------------------------------------------------------------
 * 函数名称：OFFWDT

 * 函数功能：关闭看门狗

 * 输入参数：无

 * 输出参数：无

 * 注    意：无
------------------------------------------------------------------------------------------------------------------------*/
void OFFWDT()
{
 	WDT_CONTR &= 0xDF;
}

/*------------------------------------------------------------------------------------------------------------------------
                                                  END
------------------------------------------------------------------------------------------------------------------------*/